# Правила написания системной аналитики для LLM-агентской системы (с пояснениями)

## 1. Знакомство с бизнес-контекстом и бизнес-требованиями, их уточнение

**Что указывать:**
- Описание бизнес-домена (в какой сфере работает система: финтех, HR, маркетинг и т.д.).
- Ключевые бизнес-цели и задачи, которые должен решать LLM-агент.
- Проблемы, существующие в текущем процессе, и как агент может их решить.
- Какие метрики или KPI будут применяться для оценки эффективности агента.

---

## 2. Определение ролей пользователей и приложений. Верхнеуровневое проектирование архитектуры

### Определение ролей пользователей и приложений

**Что указывать:**
- Список всех ролей (люди, сервисы, процессы), которые будут взаимодействовать с агентом.
- Для каждой роли — цели взаимодействия, задачи, которые они решают с помощью агента.
- Примеры запросов, которые могут поступать от каждой роли.

### Верхнеуровневое проектирование архитектуры

**Что указывать:**
- Компоненты архитектуры и их назначение.
- Взаимодействия между компонентами: кто с кем и как общается.
- Указать, какие компоненты развёрнуты отдельно (например, агент как сервис) и через что они связаны (REST, WebSocket, брокеры сообщений и т.п.).
- Указать, какие технологии и библиотеки применяются (например, LangChain, FastAPI, Arize Phoenix).
- Добавить диаграмму (BPMN, C4, Sequence Diagram или просто блок-схему).

---

## 3. Выделение и описание основных сценариев работы с системой

**Что указывать:**
- Для каждой роли описать типичные сценарии (Use Case), в которых используется агент.
- Структура сценария:
  - Название сценария.
  - Участвующие роли.
  - Пошаговое описание действий: кто инициирует, как обрабатывается запрос, какой результат ожидается.
  - Какие инструменты или внешние системы задействуются.
- Для каждого шага желательно уточнять: формат запроса, тип ожидаемого ответа, тип взаимодействия (синхронное/асинхронное).

---

## 4. Проработка альтернативных сценариев

**Что указывать:**
- Описание типичных ошибок и нештатных ситуаций в сценариях:
  - Ошибки подключения к внешним системам (API, БД).
  - Ошибки формата или содержания пользовательских запросов.
  - Таймауты, ошибки выполнения кода, сбои в LangChain.
- Поведение системы при таких ошибках:
  - Как обрабатывается ошибка (повтор, fallback, сообщение об ошибке).
  - Логируется ли ошибка, где и как.
  - Что получает пользователь или сервис на выходе.
- Указать, какие ошибки критичны, какие — нет.

---

## 5. Требования к безопасности

**Что указывать:**
- Как осуществляется аутентификация (например, OAuth2, JWT).
- Как реализована авторизация: какие роли имеют доступ к каким функциям/инструментам.
- Где и как хранятся секреты (например, токены к API) — с соблюдением best practices.
- Какие данные считаются конфиденциальными и как обеспечивается их защита (шифрование в передаче и хранении).
- Какие стандарты соблюдаются (например, GDPR, ISO 27001 и др.).

---

## 6. Описание нефункциональных требований

**Что указывать:**
- Ожидаемая производительность: среднее и пиковое число запросов, время отклика.
- Требования к масштабируемости: горизонтальное/вертикальное масштабирование, контейнеризация.
- Требования к доступности (например, 99.9% uptime).
- Планируемый объём логирования и требования к журналам аудита.
- Требования к трассировке: какие данные нужно собирать, как использовать Arize Phoenix.
- Варианты восстановления после отказа: что делать при сбое LLM, инструментов, Backend.

---

## 7. Определение ключевых данных: сущности и их свойства

**Что указывать:**
- Список бизнес-сущностей (например: Task, Request, ToolInvocation, UserSession).
- Для каждой сущности:
  - Назначение.
  - Основные свойства (name, id, status, created_at и т.п.).
  - Как используется в сценариях взаимодействия.
- Взаимосвязи между сущностями (например, “один пользователь → много запросов”).
- Не нужно описывать структуру таблиц или БД — только бизнес-уровень.

---

## 8. Задачи на разработку инструментов для взаимодействия с внешними системами

**Что указывать:**
- Список инструментов (tools), которые нужно реализовать.
- Для каждого инструмента:
  - Назначение (к какому API/БД обращается, зачем).
  - Входные параметры (что получает на вход).
  - Выходные данные (что возвращает).
  - Обработка ошибок (что делать при недоступности, таймаутах, некорректном ответе).
  - Особенности форматов (например, JSON, XML, авторизация к API).

---

## 9. Задачи на разработку методов Backend (методов API)

**Что указывать:**
- Список API-методов, реализуемых на FastAPI.
- Для каждого метода:
  - Название и URL endpoint.
  - Метод (GET, POST и т.д.).
  - Входные параметры: структура запроса, типы данных, обязательность.
  - Выходные данные: структура ответа, описание полей.
  - Возможные коды ошибок и их значения.
- При необходимости — описание взаимодействия по WebSocket или другим протоколам.

---

## 10. Тестирование функционала

**Что указывать:**
- Какие сценарии нужно протестировать (основные и альтернативные).
- Как будет проверяться корректность работы инструментов: подключение к БД, API.
- Как будет тестироваться агент: корректность ответа, обработка ошибок, edge cases.
- Какие средства будут использоваться для тестирования (pytest, Postman, etc.).
- Какие параметры проверяются при нагрузочном тестировании.
- Как проверяется безопасность: тесты аутентификации, попытки несанкционированного доступа.
- Как проверить трассировку и логирование (в том числе в Arize Phoenix).